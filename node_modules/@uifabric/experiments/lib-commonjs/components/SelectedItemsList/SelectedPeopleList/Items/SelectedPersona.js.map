{"version":3,"file":"SelectedPersona.js","sourceRoot":"../src/","sources":["components/SelectedItemsList/SelectedPeopleList/Items/SelectedPersona.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport {\n  styled,\n  classNamesFunction,\n  IStyleFunctionOrObject,\n  css,\n  EventGroup,\n} from 'office-ui-fabric-react/lib/Utilities';\nimport { Persona, PersonaSize, IPersonaProps } from 'office-ui-fabric-react/lib/Persona';\nimport { ISelectedItemProps } from '../../SelectedItemsList.types';\nimport { getStyles } from './SelectedPersona.styles';\nimport { ISelectedPersonaStyles, ISelectedPersonaStyleProps } from './SelectedPersona.types';\nimport { ITheme, IProcessedStyleSet } from 'office-ui-fabric-react/lib/Styling';\nimport { IconButton } from 'office-ui-fabric-react/lib/Button';\nimport { IDragDropOptions } from 'office-ui-fabric-react/lib/utilities/dragdrop/interfaces';\nimport { useId } from '@uifabric/react-hooks';\n\nconst getClassNames = classNamesFunction<ISelectedPersonaStyleProps, ISelectedPersonaStyles>();\n\ntype ISelectedPersonaProps<TPersona> = ISelectedItemProps<TPersona> & {\n  isValid?: (item: TPersona) => boolean;\n  canExpand?: (item: TPersona) => boolean;\n  getExpandedItems?: (item: TPersona) => Promise<TPersona[]>;\n\n  /**\n   * Call to provide customized styling that will layer on top of the variant rules.\n   */\n  styles?: IStyleFunctionOrObject<ISelectedPersonaStyleProps, ISelectedPersonaStyles>;\n\n  /**\n   * Theme for the component.\n   */\n  theme?: ITheme;\n};\n\nconst DEFAULT_DROPPING_CSS_CLASS = 'is-dropping';\n\n/**\n * A selected persona with support for item removal and expansion.\n *\n * To use the removal / expansion, bind isValid / canExpand /  getExpandedItems\n * when passing the onRenderItem to your SelectedItemsList\n */\nconst SelectedPersonaInner = React.memo(\n  <TPersona extends IPersonaProps = IPersonaProps>(props: ISelectedPersonaProps<TPersona>) => {\n    const {\n      item,\n      onRemoveItem,\n      onItemChange,\n      removeButtonAriaLabel,\n      index,\n      selected,\n      isValid,\n      canExpand,\n      getExpandedItems,\n      styles,\n      theme,\n      dragDropHelper,\n      dragDropEvents,\n      eventsToRegister,\n    } = props;\n    const itemId = useId();\n    const [isDropping, setIsDropping] = React.useState(false);\n    const [droppingClassNames, setDroppingClassNames] = React.useState('');\n\n    const rootRef = React.useRef<HTMLDivElement>(null);\n\n    React.useEffect(\n      () => {\n        const _updateDroppingState = (newValue: boolean, event: DragEvent) => {\n          if (!newValue) {\n            if (dragDropEvents!.onDragLeave) {\n              dragDropEvents!.onDragLeave(item, event);\n            }\n          } else if (dragDropEvents!.onDragEnter) {\n            setDroppingClassNames(dragDropEvents!.onDragEnter(item, event));\n          }\n\n          if (isDropping !== newValue) {\n            setIsDropping(newValue);\n          }\n        };\n\n        const dragDropOptions: IDragDropOptions = {\n          eventMap: eventsToRegister,\n          selectionIndex: index,\n          context: { data: item, index: index },\n          ...dragDropEvents,\n          updateDropState: _updateDroppingState,\n        };\n\n        const events = new EventGroup(this);\n\n        const subscription = dragDropHelper?.subscribe(rootRef.current as HTMLElement, events, dragDropOptions);\n\n        return () => {\n          subscription?.dispose();\n          events.dispose();\n        };\n      },\n      // eslint-disable-next-line react-hooks/exhaustive-deps -- this is the only dependency which matters\n      [dragDropHelper],\n    );\n\n    const isDraggable = React.useMemo(\n      () => (dragDropEvents && dragDropEvents.canDrag ? !!dragDropEvents.canDrag!() : undefined),\n      [dragDropEvents],\n    );\n\n    const droppingClassName = React.useMemo(\n      () => (isDropping ? droppingClassNames || DEFAULT_DROPPING_CSS_CLASS : ''),\n      [isDropping, droppingClassNames],\n    );\n\n    const onExpandClicked = React.useCallback(\n      ev => {\n        ev.stopPropagation();\n        ev.preventDefault();\n        if (onItemChange && getExpandedItems) {\n          getExpandedItems(item)\n            .then(value => {\n              onItemChange(value, index);\n            })\n            .catch(error => {\n              // No op\n            });\n        }\n      },\n      [onItemChange, getExpandedItems, item, index],\n    );\n\n    const onRemoveClicked = React.useCallback(\n      ev => {\n        ev.stopPropagation();\n        ev.preventDefault();\n        onRemoveItem && onRemoveItem();\n      },\n      [onRemoveItem],\n    );\n\n    const classNames: IProcessedStyleSet<ISelectedPersonaStyles> = React.useMemo(\n      () =>\n        getClassNames(styles, {\n          isSelected: selected || false,\n          isValid: isValid ? isValid(item) : true,\n          theme: theme!,\n          droppingClassName,\n        }),\n      // TODO: evaluate whether to add deps on `item` and `styles`\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n      [selected, isValid, theme],\n    );\n\n    const coinProps = {};\n\n    return (\n      <div\n        ref={rootRef}\n        {...(typeof isDraggable === 'boolean'\n          ? {\n              'data-is-draggable': isDraggable, // This data attribute is used by some host applications.\n              draggable: isDraggable,\n            }\n          : {})}\n        onContextMenu={props.onContextMenu}\n        onClick={props.onClick}\n        className={css('ms-PickerPersona-container', classNames.personaContainer)}\n        data-is-focusable={true}\n        data-is-sub-focuszone={true}\n        data-selection-index={index}\n        role={'listitem'}\n        aria-labelledby={'selectedItemPersona-' + itemId}\n      >\n        <div hidden={!canExpand || !canExpand(item) || !getExpandedItems}>\n          <IconButton\n            onClick={onExpandClicked}\n            iconProps={{ iconName: 'Add', style: { fontSize: '14px' } }}\n            className={css('ms-PickerItem-removeButton', classNames.expandButton)}\n            styles={classNames.subComponentStyles.actionButtonStyles()}\n            ariaLabel={removeButtonAriaLabel}\n          />\n        </div>\n        <div className={css(classNames.personaWrapper)}>\n          <div\n            className={css('ms-PickerItem-content', classNames.itemContentWrapper)}\n            id={'selectedItemPersona-' + itemId}\n          >\n            <Persona\n              {...item}\n              size={PersonaSize.size32}\n              styles={classNames.subComponentStyles.personaStyles}\n              coinProps={coinProps}\n            />\n          </div>\n          <IconButton\n            onClick={onRemoveClicked}\n            iconProps={{ iconName: 'Cancel', style: { fontSize: '14px' } }}\n            className={css('ms-PickerItem-removeButton', classNames.removeButton)}\n            styles={classNames.subComponentStyles.actionButtonStyles()}\n            ariaLabel={removeButtonAriaLabel}\n          />\n        </div>\n      </div>\n    );\n  },\n);\n\n// export casting back to typeof inner to preserve generics.\nexport const SelectedPersona = styled<ISelectedPersonaProps<any>, ISelectedPersonaStyleProps, ISelectedPersonaStyles>(\n  SelectedPersonaInner,\n  getStyles,\n  undefined,\n  {\n    scope: 'SelectedPersona',\n  },\n) as typeof SelectedPersonaInner;\n"]}