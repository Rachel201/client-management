{"version":3,"file":"MicroFeedback.state.js","sourceRoot":"../src/","sources":["components/MicroFeedback/MicroFeedback.state.ts"],"names":[],"mappings":";;;AACA,+BAAsD;AAgBzC,QAAA,qBAAqB,GAAqC,UAAA,KAAK;IAClE,IAAA,iCAAY,CAAW;IAC/B,IAAM,OAAO,GAAG,cAAM,CAAwB,IAAI,CAAC,CAAC;IACpD,IAAM,UAAU,GAAG,cAAM,CAAwB,IAAI,CAAC,CAAC;IACjD,IAAA,gCAAuE,EAAtE,mBAAW,EAAE,sBAAyD,CAAC;IACxE,IAAA,gCAA+C,EAA9C,YAAI,EAAE,eAAwC,CAAC;IAChD,IAAA,4BAA2D,EAA1D,yBAAiB,EAAE,4BAAuC,CAAC;IAC5D,IAAA,4BAAuD,EAAtD,uBAAe,EAAE,0BAAqC,CAAC;IAE9D,IAAM,gBAAgB,GAAG,mBAAW,CAAC;QACnC,oBAAoB,CAAC,KAAK,CAAC,CAAC;IAC9B,CAAC,EAAE,EAAE,CAAC,CAAC;IAEP,IAAM,eAAe,GAAG,mBAAW,CAAC;QAClC,YAAY,CAAC,WAAW,CAAC,CAAC;QAC1B,kBAAkB,CAAC,KAAK,CAAC,CAAC;IAC5B,CAAC,EAAE,CAAC,WAAW,CAAC,CAAC,CAAC;IAElB,IAAM,WAAW,GAAG,mBAAW,CAC7B,UAAC,OAAiB;QAChB,kEAAkE;QAClE,IAAM,WAAW,GAAa,IAAI,KAAK,OAAO,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,OAAO,CAAC;QACrE,oBAAoB,CAAC,IAAI,CAAC,CAAC;QAC3B,OAAO,CAAC,WAAW,CAAC,CAAC;QACrB,IAAI,WAAW,KAAK,SAAS,IAAI,YAAY,EAAE;YAC7C,YAAY,CAAC,WAAW,CAAC,CAAC;SAC3B;IACH,CAAC,EACD,CAAC,YAAY,EAAE,IAAI,CAAC,CACrB,CAAC;IAEF,IAAM,UAAU,GAAG,mBAAW,CAAC;QAC7B,WAAW,CAAC,MAAM,CAAC,CAAC;IACtB,CAAC,EAAE,CAAC,WAAW,CAAC,CAAC,CAAC;IAElB,IAAM,aAAa,GAAG,mBAAW,CAAC;QAChC,WAAW,CAAC,SAAS,CAAC,CAAC;IACzB,CAAC,EAAE,CAAC,WAAW,CAAC,CAAC,CAAC;IAElB,IAAM,iBAAiB,GAAG,mBAAW,CAAC;QACpC,kBAAkB,CAAC,KAAK,CAAC,CAAC;IAC5B,CAAC,EAAE,EAAE,CAAC,CAAC;IAEP,IAAM,YAAY,GAAG,mBAAW,CAAC;QAC/B,kBAAkB,CAAC,IAAI,CAAC,CAAC;QAEzB,0CAA0C;QAC1C,cAAc,CAAE,UAAU,CAAC,iBAAiB,EAAE,IAAI,CAAuB,CAAC,CAAC;IAC7E,CAAC,EAAE,CAAC,iBAAiB,CAAC,CAAC,CAAC;IAExB,IAAM,SAAS,yCACV,KAAK,KACR,IAAI,EAAE,IAAI,EACV,iBAAiB,mBAAA;QACjB,OAAO,SAAA;QACP,UAAU,YAAA;QACV,gBAAgB,kBAAA;QAChB,eAAe,iBAAA;QACf,YAAY,cAAA;QACZ,UAAU,YAAA;QACV,aAAa,eAAA;QACb,eAAe,iBAAA,GAChB,CAAC;IACF,OAAO,SAAS,CAAC;AACnB,CAAC,CAAC","sourcesContent":["import { IMicroFeedbackComponent, IMicroFeedbackViewProps, VoteType } from './MicroFeedback.types';\nimport { useCallback, useRef, useState } from 'react';\n\nexport type IMicroFeedbackState = Pick<\n  IMicroFeedbackViewProps,\n  | 'vote'\n  | 'isFollowUpVisible'\n  | 'likeRef'\n  | 'dislikeRef'\n  | 'onCalloutDismiss'\n  | 'onThanksDismiss'\n  | 'onThanksShow'\n  | 'onLikeVote'\n  | 'onDislikeVote'\n  | 'isThanksVisible'\n>;\n\nexport const useMicroFeedbackState: IMicroFeedbackComponent['state'] = props => {\n  const { sendFeedback } = props;\n  const likeRef = useRef<HTMLDivElement | null>(null);\n  const dislikeRef = useRef<HTMLDivElement | null>(null);\n  const [timerHandle, setTimerHandle] = useState<number | undefined>(undefined);\n  const [vote, setVote] = useState<VoteType>('no_vote');\n  const [isFollowUpVisible, setIsFollowUpVisible] = useState(false);\n  const [isThanksVisible, setIsThanksVisible] = useState(false);\n\n  const onCalloutDismiss = useCallback((): void => {\n    setIsFollowUpVisible(false);\n  }, []);\n\n  const onThanksDismiss = useCallback((): void => {\n    clearTimeout(timerHandle);\n    setIsThanksVisible(false);\n  }, [timerHandle]);\n\n  const processVote = useCallback(\n    (newVote: VoteType): void => {\n      // If the vote that is already selected is picked, then toggle off\n      const updatedVote: VoteType = vote === newVote ? 'no_vote' : newVote;\n      setIsFollowUpVisible(true);\n      setVote(updatedVote);\n      if (updatedVote !== 'no_vote' && sendFeedback) {\n        sendFeedback(updatedVote);\n      }\n    },\n    [sendFeedback, vote],\n  );\n\n  const onLikeVote = useCallback((): void => {\n    processVote('like');\n  }, [processVote]);\n\n  const onDislikeVote = useCallback((): void => {\n    processVote('dislike');\n  }, [processVote]);\n\n  const hideThanksMessage = useCallback((): void => {\n    setIsThanksVisible(false);\n  }, []);\n\n  const onThanksShow = useCallback((): void => {\n    setIsThanksVisible(true);\n\n    // Hide the Thanks message after 2 seconds\n    setTimerHandle((setTimeout(hideThanksMessage, 2000) as unknown) as number);\n  }, [hideThanksMessage]);\n\n  const viewProps: IMicroFeedbackViewProps = {\n    ...props,\n    vote: vote,\n    isFollowUpVisible,\n    likeRef,\n    dislikeRef,\n    onCalloutDismiss,\n    onThanksDismiss,\n    onThanksShow,\n    onLikeVote,\n    onDislikeVote,\n    isThanksVisible,\n  };\n  return viewProps;\n};\n"]}