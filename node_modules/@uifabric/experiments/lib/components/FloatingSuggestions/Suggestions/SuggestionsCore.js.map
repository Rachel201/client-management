{"version":3,"file":"SuggestionsCore.js","sourceRoot":"../src/","sources":["components/FloatingSuggestions/Suggestions/SuggestionsCore.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { css, initializeComponentRef } from 'office-ui-fabric-react/lib/Utilities';\nimport { ISuggestionModel } from 'office-ui-fabric-react/lib/Pickers';\nimport { SuggestionsItem } from './SuggestionsItem';\nimport { ISuggestionsCoreProps } from './Suggestions.types';\nimport * as stylesImport from './SuggestionsCore.scss';\nconst styles: any = stylesImport;\n\n/**\n * true if the input is an object with a 'key' property that is a number or a string\n * (e.g. is a valid react key).\n */\nfunction hasKey<T>(i: T): i is T & { key: string | number } {\n  if (!(i instanceof Object) || !(i as Object).hasOwnProperty('key')) {\n    return false;\n  }\n  const keyType = typeof (i as T & { key: any }).key;\n  return keyType === 'string' || keyType === 'number';\n}\n\n/**\n * Class when used with SuggestionsStore, renders a basic suggestions control\n */\nexport class SuggestionsCore<T> extends React.Component<ISuggestionsCoreProps<T>, {}> {\n  public currentIndex: number;\n  public currentSuggestion: ISuggestionModel<T> | undefined;\n  protected _selectedElement = React.createRef<HTMLDivElement>();\n\n  constructor(suggestionsProps: ISuggestionsCoreProps<T>) {\n    super(suggestionsProps);\n\n    initializeComponentRef(this);\n    this.currentIndex = -1;\n  }\n\n  /**\n   * Increments the selected suggestion index\n   */\n  public nextSuggestion(): boolean {\n    const { suggestions } = this.props;\n\n    if (suggestions && suggestions.length > 0) {\n      if (this.currentIndex === -1) {\n        this.setSelectedSuggestion(0);\n        return true;\n      } else if (this.currentIndex < suggestions.length - 1) {\n        this.setSelectedSuggestion(this.currentIndex + 1);\n        return true;\n      } else if (this.props.shouldLoopSelection && this.currentIndex === suggestions.length - 1) {\n        this.setSelectedSuggestion(0);\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   * Decrements the selected suggestion index\n   */\n  public previousSuggestion(): boolean {\n    const { suggestions } = this.props;\n\n    if (suggestions && suggestions.length > 0) {\n      if (this.currentIndex === -1) {\n        this.setSelectedSuggestion(suggestions.length - 1);\n        return true;\n      } else if (this.currentIndex > 0) {\n        this.setSelectedSuggestion(this.currentIndex - 1);\n        return true;\n      } else if (this.props.shouldLoopSelection && this.currentIndex === 0) {\n        this.setSelectedSuggestion(suggestions.length - 1);\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  public get selectedElement(): HTMLDivElement | undefined {\n    return this._selectedElement.current || undefined;\n  }\n\n  public getCurrentItem(): ISuggestionModel<T> {\n    return this.props.suggestions[this.currentIndex];\n  }\n\n  public getSuggestionAtIndex(index: number): ISuggestionModel<T> {\n    return this.props.suggestions[index];\n  }\n\n  public hasSuggestionSelected(): boolean {\n    return this.currentIndex !== -1 && this.currentIndex < this.props.suggestions.length;\n  }\n\n  public removeSuggestion(index: number): void {\n    this.props.suggestions.splice(index, 1);\n  }\n\n  public deselectAllSuggestions(): void {\n    if (this.currentIndex > -1 && this.props.suggestions[this.currentIndex]) {\n      this.props.suggestions[this.currentIndex].selected = false;\n      this.currentIndex = -1;\n      this.forceUpdate();\n    }\n  }\n\n  public setSelectedSuggestion(index: number): void {\n    const { suggestions } = this.props;\n\n    if (index > suggestions.length - 1 || index < 0) {\n      this.currentIndex = 0;\n      this.currentSuggestion!.selected = false;\n      this.currentSuggestion = suggestions[0];\n      this.currentSuggestion.selected = true;\n    } else {\n      if (this.currentIndex > -1 && suggestions[this.currentIndex]) {\n        suggestions[this.currentIndex].selected = false;\n      }\n      suggestions[index].selected = true;\n      this.currentIndex = index;\n      this.currentSuggestion = suggestions[index];\n    }\n\n    this.forceUpdate();\n  }\n\n  public componentDidUpdate(): void {\n    this.scrollSelected();\n  }\n\n  public render(): JSX.Element {\n    const {\n      onRenderSuggestion,\n      suggestionsItemClassName,\n      resultsMaximumNumber,\n      showRemoveButtons,\n      suggestionsContainerAriaLabel,\n    } = this.props;\n    let { suggestions } = this.props;\n\n    if (resultsMaximumNumber) {\n      suggestions = suggestions.slice(0, resultsMaximumNumber);\n    }\n\n    return (\n      <div\n        className={css('ms-Suggestions-container', styles.suggestionsContainer)}\n        id=\"suggestion-list\"\n        role=\"list\"\n        aria-label={suggestionsContainerAriaLabel}\n      >\n        {suggestions.map((suggestion: ISuggestionModel<T>, index: number) => (\n          <div\n            ref={suggestion.selected || index === this.currentIndex ? this._selectedElement : undefined}\n            key={hasKey(suggestion.item) ? suggestion.item.key : index}\n            id={'sug-' + index}\n            role=\"listitem\"\n            aria-label={suggestion.ariaLabel}\n          >\n            <SuggestionsItem\n              id={'sug-item' + index}\n              suggestionModel={suggestion}\n              onRenderSuggestion={onRenderSuggestion}\n              onClick={this._onClickTypedSuggestionsItem(suggestion.item, index)}\n              className={suggestionsItemClassName}\n              showRemoveButton={showRemoveButtons}\n              onRemoveItem={this._onRemoveTypedSuggestionsItem(suggestion.item, index)}\n              isSelectedOverride={index === this.currentIndex}\n            />\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  // TODO get the element to scroll into view properly regardless of direction.\n  public scrollSelected(): void {\n    if (this._selectedElement.current?.scrollIntoView !== undefined) {\n      this._selectedElement.current.scrollIntoView(false);\n    }\n  }\n\n  private _onClickTypedSuggestionsItem = (item: T, index: number): ((ev: React.MouseEvent<HTMLElement>) => void) => {\n    return (ev: React.MouseEvent<HTMLElement>): void => {\n      this.props.onSuggestionClick(ev, item, index);\n    };\n  };\n\n  private _onRemoveTypedSuggestionsItem = (item: T, index: number): ((ev: React.MouseEvent<HTMLElement>) => void) => {\n    return (ev: React.MouseEvent<HTMLElement>): void => {\n      const onSuggestionRemove = this.props.onSuggestionRemove!;\n      onSuggestionRemove(ev, item, index);\n      ev.stopPropagation();\n    };\n  };\n}\n"]}