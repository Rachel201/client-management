{"version":3,"file":"ExpandingCard.js","sourceRoot":"../src/","sources":["components/HoverCard/ExpandingCard.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport {\n  BaseComponent,\n  getNativeProps,\n  divProperties,\n  customizable,\n  KeyCodes,\n  createRef\n} from '../../Utilities';\nimport { IExpandingCardProps, IExpandingCardStyles, ExpandingCardMode } from './ExpandingCard.types';\nimport { Callout, ICallout } from '../../Callout';\nimport { DirectionalHint } from '../../common/DirectionalHint';\nimport { mergeStyles } from '../../Styling';\nimport { FocusTrapZone } from '../../FocusTrapZone';\nimport { getStyles } from './ExpandingCard.styles';\n\nexport interface IExpandingCardState {\n  firstFrameRendered: boolean;\n  needsScroll: boolean;\n}\n\n@customizable('ExpandingCard', ['theme'])\nexport class ExpandingCard extends BaseComponent<IExpandingCardProps, IExpandingCardState> {\n  public static defaultProps = {\n    compactCardHeight: 156,\n    expandedCardHeight: 384,\n    directionalHint: DirectionalHint.bottomLeftEdge,\n    directionalHintFixed: true,\n    gapSpace: 0\n  };\n\n  private _styles: IExpandingCardStyles;\n  // tslint:disable-next-line:no-unused-variable\n  private _callout = createRef<ICallout>();\n  private _expandedElem = createRef<HTMLDivElement>();\n\n  constructor(props: IExpandingCardProps) {\n    super(props);\n\n    this.state = {\n      firstFrameRendered: false,\n      needsScroll: false\n    };\n  }\n\n  public componentDidMount(): void {\n    this._checkNeedsScroll();\n  }\n\n  public componentWillUnmount(): void {\n    this._async.dispose();\n  }\n\n  public render(): JSX.Element {\n    const {\n      targetElement,\n      theme,\n      styles: customStyles,\n      compactCardHeight,\n      directionalHintFixed,\n      firstFocus,\n      expandedCardHeight\n    } = this.props;\n    this._styles = getStyles(theme!, customStyles);\n\n    const content = (\n      <div\n        onMouseEnter={ this.props.onEnter }\n        onMouseLeave={ this.props.onLeave }\n        onKeyDown={ this._onKeyDown }\n      >\n        { this._onRenderCompactCard() }\n        { this._onRenderExpandedCard() }\n      </div>\n    );\n\n    return (\n      <Callout\n        { ...getNativeProps(this.props, divProperties) }\n        componentRef={ this._callout }\n        className={ mergeStyles(this._styles.root) }\n        target={ targetElement }\n        isBeakVisible={ false }\n        directionalHint={ this.props.directionalHint }\n        directionalHintFixed={ directionalHintFixed }\n        finalHeight={ compactCardHeight! + expandedCardHeight! }\n        minPagePadding={ 24 }\n        onDismiss={ this.props.onLeave }\n        gapSpace={ this.props.gapSpace }\n      >\n        { this.props.trapFocus ?\n          <FocusTrapZone forceFocusInsideTrap={ false } isClickableOutsideFocusTrap={ true } disableFirstFocus={ !firstFocus }>\n            { content }\n          </FocusTrapZone> :\n          content\n        }\n      </Callout >\n    );\n  }\n\n  private _onKeyDown = (ev: React.KeyboardEvent<HTMLElement>): void => {\n    if (ev.which === KeyCodes.escape) {\n      this.props.onLeave && this.props.onLeave(ev);\n    }\n  }\n\n  private _onRenderCompactCard = (): JSX.Element => {\n    return (\n      <div className={ mergeStyles(this._styles.compactCard, { height: this.props.compactCardHeight + 'px' }) as string }>\n        { this.props.onRenderCompactCard!(this.props.renderData) }\n      </div>\n    );\n  }\n\n  private _onRenderExpandedCard = (): JSX.Element => {\n    // firstFrameRendered helps in initially setting height of expanded card to 1px, even if\n    // mode prop is set to ExpandingCardMode.expanded on first render. This is to make sure transition animation takes place.\n    !this.state.firstFrameRendered && this._async.requestAnimationFrame(() => {\n      this.setState({\n        firstFrameRendered: true\n      });\n    });\n\n    return (\n      <div\n        className={ mergeStyles(\n          this._styles.expandedCard,\n          this.props.mode === ExpandingCardMode.expanded && this.state.firstFrameRendered && { height: this.props.expandedCardHeight + 'px' }\n        ) }\n        ref={ this._expandedElem }\n      >\n        <div className={ mergeStyles(this.state.needsScroll && this._styles.expandedCardScroll) }>\n          { this.props.onRenderExpandedCard && this.props.onRenderExpandedCard(this.props.renderData) }\n        </div>\n      </div>\n    );\n  }\n\n  private _checkNeedsScroll = (): void => {\n    if (this._expandedElem.current) {\n      this._async.requestAnimationFrame(() => {\n        if (this._expandedElem.current && this._expandedElem.current.scrollHeight >= this.props.expandedCardHeight!) {\n          this.setState({\n            needsScroll: true\n          });\n        }\n      });\n    }\n  }\n}\n"]}