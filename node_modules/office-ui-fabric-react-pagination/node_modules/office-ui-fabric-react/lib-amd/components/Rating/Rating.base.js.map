{"version":3,"file":"Rating.base.js","sourceRoot":"../src/","sources":["components/Rating/Rating.base.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport {\n  BaseComponent,\n  classNamesFunction,\n  css,\n  customizable,\n  format,\n  getId\n} from '../../Utilities';\nimport {\n  IClassNames\n} from '@uifabric/utilities/lib/IClassNames';\nimport { Icon } from '../../Icon';\nimport { FocusZone, FocusZoneDirection } from '../../FocusZone';\nimport { IRatingProps, RatingSize, IRatingStyleProps, IRatingStyles } from './Rating.types';\n\nconst getClassNames = classNamesFunction<IRatingStyleProps, IRatingStyles>();\n\ninterface IRatingStarProps extends React.AllHTMLAttributes<HTMLElement> {\n  fillPercentage: number;\n  disabled: boolean;\n  readOnly: boolean;\n  classNames: IClassNames<IRatingStyles>;\n}\n\nexport interface IRatingState {\n  rating: number | null | undefined;\n}\n\nconst RatingStar = (props: IRatingStarProps, ) => (\n  <div\n    className={ props.classNames.ratingStar }\n    key={ props.id }\n  >\n    <Icon\n      className={ props.classNames.ratingStarBack }\n      iconName='FavoriteStarFill'\n    />\n    {\n      !props.disabled &&\n      <Icon\n        className={ props.classNames.ratingStarFront }\n        iconName='FavoriteStarFill'\n        style={ { width: props.fillPercentage + '%' } }\n      />\n    }\n  </div >\n);\n\n@customizable('Rating', ['theme', 'getStyles'])\nexport class RatingBase extends BaseComponent<IRatingProps, IRatingState> {\n  public static defaultProps: IRatingProps = {\n    min: 1,\n    max: 5\n  };\n  private _id: string;\n  private _min: number;\n  private _labelId: string;\n  private _classNames: { [key in keyof IRatingStyles]: string };\n\n  constructor(props: IRatingProps) {\n    super(props);\n\n    this._id = getId('Rating');\n    this._min = this.props.allowZeroStars ? 0 : 1;\n    if (this.props.min !== undefined && this.props.min !== 1) {\n      this._min = this.props.min;\n    }\n    this._labelId = getId('RatingLabel');\n\n    this.state = {\n      rating: this._getInitialValue(props)\n    };\n  }\n\n  public componentWillReceiveProps(nextProps: IRatingProps): void {\n    if (typeof nextProps.rating !== 'undefined' && nextProps.rating !== this.state.rating) {\n      this.setState({\n        rating: this._getClampedRating(nextProps.rating)\n      } as IRatingState);\n    }\n  }\n\n  public render(): JSX.Element {\n    const id = this._id;\n    const stars = [];\n    const starIds = [];\n    const {\n      disabled,\n      getAriaLabel,\n      getStyles,\n      max,\n      rating,\n      readOnly,\n      size,\n      theme\n    } = this.props;\n\n    this._classNames = getClassNames(getStyles!, {\n      disabled,\n      readOnly,\n      theme: theme!\n    });\n\n    for (let i = this._min as number; i <= (max as number); i++) {\n      if (i !== 0) {\n        const ratingStarProps: IRatingStarProps = {\n          fillPercentage: this._getFillingPercentage(i),\n          disabled: disabled ? true : false,\n          readOnly: readOnly ? true : false,\n          classNames: this._classNames\n        };\n\n        starIds.push(this._getStarId(i - 1));\n\n        stars.push(\n          <button\n            className={ css(this._classNames.ratingButton, {\n              [this._classNames.ratingStarIsLarge]: size === RatingSize.Large,\n              [this._classNames.ratingStarIsSmall]: size !== RatingSize.Large\n            }) }\n            id={ starIds[i - 1] }\n            key={ i }\n            { ...((i === Math.ceil(this.state.rating as number)) ? { 'data-is-current': true } : {}) }\n            onFocus={ this._onFocus.bind(this, i) }\n            onClick={ this._onFocus.bind(this, i) } // For Safari & Firefox on OSX\n            disabled={ disabled || readOnly ? true : false }\n            role='presentation'\n            type='button'\n          >\n            { this._getLabel(i) }\n            <RatingStar key={ i + 'rating' }  { ...ratingStarProps } />\n          </button>\n        );\n      }\n    }\n\n    return (\n      <div\n        className={ css('ms-Rating-star', this._classNames.root, {\n          [this._classNames.rootIsLarge]: size === RatingSize.Large,\n          [this._classNames.rootIsSmall]: size !== RatingSize.Large\n        }) }\n        aria-label={ getAriaLabel ? getAriaLabel(this.state.rating ? this.state.rating : 0, this.props.max as number) : '' }\n        id={ id }\n      >\n        <FocusZone\n          direction={ FocusZoneDirection.horizontal }\n          tabIndex={ readOnly ? 0 : -1 }\n          className={ css(this._classNames.ratingFocusZone, {\n            [this._classNames.rootIsLarge]: size === RatingSize.Large,\n            [this._classNames.rootIsSmall]: size !== RatingSize.Large\n          }) }\n          data-is-focusable={ readOnly ? true : false }\n          defaultActiveElement={ rating ? starIds[rating - 1] && '#' + starIds[rating - 1] : undefined }\n        >\n          { stars }\n        </FocusZone>\n      </div>\n    );\n  }\n\n  private _getStarId(index: number): string {\n    return this._id + '-star-' + index;\n  }\n\n  private _onFocus(value: number, ev: React.FocusEvent<HTMLElement>): void {\n    if (this.state.rating !== value) {\n      this.setState({\n        rating: value\n      } as IRatingState);\n\n      const { onChanged } = this.props;\n      if (onChanged) {\n        onChanged(value);\n      }\n    }\n  }\n\n  private _getLabel(rating: number): JSX.Element {\n    const text = this.props.ariaLabelFormat || '';\n\n    return (\n      <span\n        id={ `${this._labelId}-${rating}` }\n        className={ this._classNames.labelText }\n      >\n        { format(text, rating, this.props.max) }\n      </span >\n    );\n  }\n\n  private _getInitialValue(props: IRatingProps): number | undefined {\n    if (typeof props.rating === 'undefined') {\n      return this._min;\n    }\n\n    if (props.rating === null) {\n      return undefined;\n    }\n\n    return this._getClampedRating(props.rating);\n  }\n\n  private _getClampedRating(rating: number): number {\n    return Math.min(Math.max(rating, this._min as number), this.props.max as number);\n  }\n\n  private _getFillingPercentage(starPosition: number): number {\n    const ceilValue = Math.ceil((this.state.rating as number));\n    let fillPercentage = 100;\n\n    if (starPosition === this.state.rating) {\n      fillPercentage = 100;\n    } else if (starPosition === ceilValue) {\n      fillPercentage = 100 * (this.state.rating as number % 1);\n    } else if (starPosition > ceilValue) {\n      fillPercentage = 0;\n    }\n    return fillPercentage;\n  }\n}\n"]}