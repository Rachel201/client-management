{"version":3,"file":"BasePicker.js","sourceRoot":"../src/","sources":["components/pickers/BasePicker.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { BaseComponent, KeyCodes, css, createRef, elementContains, getId } from '../../Utilities';\nimport { IFocusZone, FocusZone, FocusZoneDirection } from '../../FocusZone';\nimport { Callout, DirectionalHint } from '../../Callout';\nimport { Selection, SelectionZone, SelectionMode } from '../../utilities/selection/index';\nimport { Suggestions } from './Suggestions/Suggestions';\nimport { ISuggestionsProps } from './Suggestions/Suggestions.types';\nimport { SuggestionsController } from './Suggestions/SuggestionsController';\nimport { IBasePicker, IBasePickerProps, ValidationState } from './BasePicker.types';\nimport { IAutofill, Autofill } from '../Autofill/index';\nimport { IPickerItemProps } from './PickerItem.types';\nimport { IPersonaProps } from '../Persona/Persona.types';\nimport * as stylesImport from './BasePicker.scss';\nconst styles: any = stylesImport;\n\nexport interface IBasePickerState {\n  items?: any;\n  suggestedDisplayValue?: string;\n  moreSuggestionsAvailable?: boolean;\n  isFocused?: boolean;\n  isSearching?: boolean;\n  isMostRecentlyUsedVisible?: boolean;\n  suggestionsVisible?: boolean;\n  suggestionsLoading?: boolean;\n  isResultsFooterVisible?: boolean;\n  selectedIndices?: number[];\n}\n\n/**\n * Aria id's for internal picker components\n */\nexport type IPickerAriaIds = {\n  /**\n   * Aria id for selected suggestion alert component\n   */\n  selectedSuggestionAlert: string;\n  /**\n   * Aria id for selected items container component\n   */\n  selectedItems: string;\n  /**\n   * Aria id for suggestions list component\n   */\n  suggestionList: string;\n};\n\nexport class BasePicker<T, P extends IBasePickerProps<T>> extends BaseComponent<P, IBasePickerState>\n  implements IBasePicker<T> {\n  protected selection: Selection;\n\n  protected root = createRef<HTMLDivElement>();\n  protected input = createRef<IAutofill>();\n  protected focusZone = createRef<IFocusZone>();\n  protected suggestionElement = createRef<Suggestions<T>>();\n\n  protected suggestionStore: SuggestionsController<T>;\n  protected SuggestionOfProperType = Suggestions as new (props: ISuggestionsProps<T>) => Suggestions<T>;\n  protected currentPromise: PromiseLike<any> | undefined;\n  protected _ariaMap: IPickerAriaIds;\n  private _id: string;\n\n  constructor(basePickerProps: P) {\n    super(basePickerProps);\n\n    const items: T[] = basePickerProps.selectedItems || basePickerProps.defaultSelectedItems || [];\n\n    this._id = getId();\n    this._ariaMap = {\n      selectedItems: `selected-items-${this._id}`,\n      selectedSuggestionAlert: `selected-suggestion-alert-${this._id}`,\n      suggestionList: `suggestion-list-${this._id}`\n    };\n    this.suggestionStore = new SuggestionsController<T>();\n    this.selection = new Selection({ onSelectionChanged: () => this.onSelectionChange() });\n    this.selection.setItems(items);\n    this.state = {\n      items: items,\n      suggestedDisplayValue: '',\n      isMostRecentlyUsedVisible: false,\n      moreSuggestionsAvailable: false,\n      isFocused: false,\n      isSearching: false,\n      selectedIndices: []\n    };\n  }\n\n  public get items(): T[] {\n    return this.state.items;\n  }\n\n  public componentWillUpdate(newProps: P, newState: IBasePickerState): void {\n    if (newState.items && newState.items !== this.state.items) {\n      this.selection.setItems(newState.items);\n    }\n  }\n\n  public componentDidMount(): void {\n    this.selection.setItems(this.state.items);\n    this._onResolveSuggestions = this._async.debounce(this._onResolveSuggestions, this.props.resolveDelay);\n  }\n\n  public componentWillReceiveProps(newProps: P): void {\n    const newItems = newProps.selectedItems;\n\n    if (newItems) {\n      let focusIndex: number;\n\n      // If there are less new items than old items then something was removed and we\n      // should try to keep focus consistent\n      if (newItems.length < this.state.items.length) {\n        focusIndex = this.state.items.indexOf(this.selection.getSelection()[0]);\n      }\n\n      this.setState({\n        items: newProps.selectedItems\n      }, () => {\n        if (focusIndex >= 0) {\n          this.resetFocus(focusIndex);\n        }\n      });\n    }\n  }\n\n  public componentWillUnmount(): void {\n    super.componentWillUnmount();\n    if (this.currentPromise) {\n      this.currentPromise = undefined;\n    }\n  }\n\n  public focus() {\n    if (this.focusZone.current) {\n      this.focusZone.current.focus();\n    }\n  }\n\n  public focusInput() {\n    if (this.input.current) {\n      this.input.current.focus();\n    }\n  }\n\n  public dismissSuggestions = (ev?: any): void => {\n    const selectItemFunction = () => {\n      if (this.props.onDismiss) {\n        this.props.onDismiss(\n          ev,\n          this.suggestionStore.currentSuggestion ? this.suggestionStore.currentSuggestion.item : undefined\n        );\n      }\n\n      if (!ev || (ev && !ev.defaultPrevented)) {\n        // Select the first suggestion if one is available when user leaves.\n        if (this.canAddItems() && this.suggestionStore.hasSelectedSuggestion() && this.state.suggestedDisplayValue) {\n          this.addItemByIndex(0);\n        }\n      }\n    };\n\n    if (this.currentPromise) {\n      this.currentPromise.then(() => selectItemFunction());\n    } else {\n      selectItemFunction();\n    }\n    this.setState({ suggestionsVisible: false });\n  }\n\n  public completeSuggestion() {\n    if (this.suggestionStore.hasSelectedSuggestion() && this.input.current) {\n      this.addItem(this.suggestionStore.currentSuggestion!.item);\n      this.updateValue('');\n      this.input.current.clear();\n    }\n  }\n\n  public refocusSuggestions = (keyCode: KeyCodes): void => {\n    this.resetFocus();\n    if (this.suggestionStore.suggestions && this.suggestionStore.suggestions.length > 0) {\n      if (keyCode === KeyCodes.up) {\n        this.suggestionStore.setSelectedSuggestion(this.suggestionStore.suggestions.length - 1);\n      } else if (keyCode === KeyCodes.down) {\n        this.suggestionStore.setSelectedSuggestion(0);\n      }\n    }\n  }\n\n  public render(): JSX.Element {\n    const { suggestedDisplayValue } = this.state;\n    const {\n      className,\n      inputProps,\n      disabled\n    } = this.props;\n\n    const selectedSuggestionAlertId = this.props.enableSelectedSuggestionAlert\n      ? this._ariaMap.selectedSuggestionAlert\n      : '';\n    const suggestionsAvailable = this.state.suggestionsVisible ? this._ariaMap.suggestionList : '';\n\n    return (\n      <div\n        ref={ this.root }\n        className={ css(\n          'ms-BasePicker',\n          className ? className : '') }\n        onKeyDown={ this.onKeyDown }\n      >\n        <FocusZone\n          componentRef={ this.focusZone }\n          direction={ FocusZoneDirection.bidirectional }\n          isInnerZoneKeystroke={ this._isFocusZoneInnerKeystroke }\n        >\n          { this.getSuggestionsAlert() }\n          <SelectionZone selection={ this.selection } selectionMode={ SelectionMode.multiple }>\n            <div\n              className={ css('ms-BasePicker-text', styles.pickerText, this.state.isFocused && styles.inputFocused) }\n              role={ 'list' }\n            >\n              <span id={ this._ariaMap.selectedItems }>{ this.renderItems() }</span>\n              { this.canAddItems() && (\n                <Autofill\n                  { ...inputProps as any }\n                  className={ css('ms-BasePicker-input', styles.pickerInput) }\n                  ref={ this.input }\n                  onFocus={ this.onInputFocus }\n                  onBlur={ this.onInputBlur }\n                  onInputValueChange={ this.onInputChange }\n                  suggestedDisplayValue={ suggestedDisplayValue }\n                  aria-activedescendant={ this.getActiveDescendant() }\n                  aria-expanded={ !!this.state.suggestionsVisible }\n                  aria-haspopup='true'\n                  aria-describedby={ this._ariaMap.selectedItems }\n                  autoCapitalize='off'\n                  autoComplete='off'\n                  role={ 'combobox' }\n                  disabled={ disabled }\n                  aria-controls={ `${suggestionsAvailable} ${selectedSuggestionAlertId}` || undefined }\n                  aria-owns={ suggestionsAvailable || undefined }\n                  aria-autocomplete={ 'both' }\n                  onInputChange={ this.props.onInputChange }\n                />\n              ) }\n            </div>\n          </SelectionZone>\n        </FocusZone>\n        { this.renderSuggestions() }\n      </div>\n    );\n  }\n\n  protected canAddItems(): boolean {\n    const { items } = this.state;\n    const { itemLimit } = this.props;\n    return itemLimit === undefined || items.length < itemLimit;\n  }\n\n  protected renderSuggestions(): JSX.Element | null {\n    const TypedSuggestion = this.SuggestionOfProperType;\n    return this.state.suggestionsVisible && this.input ? (\n      <Callout\n        isBeakVisible={ false }\n        gapSpace={ 5 }\n        target={ this.input.current ? this.input.current.inputElement : undefined }\n        onDismiss={ this.dismissSuggestions }\n        directionalHint={ DirectionalHint.bottomLeftEdge }\n        directionalHintForRTL={ DirectionalHint.bottomRightEdge }\n      >\n        <TypedSuggestion\n          onRenderSuggestion={ this.props.onRenderSuggestionsItem }\n          onSuggestionClick={ this.onSuggestionClick }\n          onSuggestionRemove={ this.onSuggestionRemove }\n          suggestions={ this.suggestionStore.getSuggestions() }\n          ref={ this.suggestionElement }\n          onGetMoreResults={ this.onGetMoreResults }\n          moreSuggestionsAvailable={ this.state.moreSuggestionsAvailable }\n          isLoading={ this.state.suggestionsLoading }\n          isSearching={ this.state.isSearching }\n          isMostRecentlyUsedVisible={ this.state.isMostRecentlyUsedVisible }\n          isResultsFooterVisible={ this.state.isResultsFooterVisible }\n          refocusSuggestions={ this.refocusSuggestions }\n          removeSuggestionAriaLabel={ this.props.removeButtonAriaLabel }\n          suggestionsListId={ this._ariaMap.suggestionList }\n          { ...this.props.pickerSuggestionsProps as any }\n        />\n      </Callout>\n    ) : (null);\n  }\n\n  protected renderItems(): JSX.Element[] {\n    const { disabled, removeButtonAriaLabel } = this.props;\n    const onRenderItem = this.props.onRenderItem as (props: IPickerItemProps<T>) => JSX.Element;\n\n    const { items, selectedIndices } = this.state;\n    return items.map((item: any, index: number) =>\n      onRenderItem({\n        item,\n        index,\n        key: item.key ? item.key : index,\n        selected: selectedIndices!.indexOf(index) !== -1,\n        onRemoveItem: () => this.removeItem(item, true),\n        disabled: disabled,\n        onItemChange: this.onItemChange,\n        removeButtonAriaLabel: removeButtonAriaLabel\n      })\n    );\n  }\n\n  protected resetFocus(index?: number) {\n    const { items } = this.state;\n\n    if (items.length && index! >= 0) {\n      const newEl: HTMLElement | null = this.root.current && this.root.current.querySelectorAll('[data-selection-index]')[Math.min(index!, items.length - 1)] as HTMLElement | null;\n      if (newEl && this.focusZone.current) {\n        this.focusZone.current.focusElement(newEl);\n      }\n    } else if (!this.canAddItems()) {\n      (items[items.length - 1] as IPickerItemProps<T>).selected = true;\n      this.resetFocus(items.length - 1);\n    } else {\n      if (this.input.current) {\n        this.input.current.focus();\n      }\n    }\n  }\n\n  protected onSuggestionSelect() {\n    if (this.suggestionStore.currentSuggestion) {\n      const currentValue: string = this.input.current ? this.input.current.value : '';\n      const itemValue: string = this._getTextFromItem(this.suggestionStore.currentSuggestion.item, currentValue);\n      this.setState({ suggestedDisplayValue: itemValue });\n    }\n  }\n\n  protected onSelectionChange() {\n    this.setState({\n      selectedIndices: this.selection.getSelectedIndices()\n    });\n  }\n\n  protected updateSuggestions(suggestions: any[]) {\n    this.suggestionStore.updateSuggestions(suggestions, 0);\n    this.forceUpdate();\n  }\n\n  protected onEmptyInputFocus() {\n    const onEmptyInputFocus = this.props.onEmptyInputFocus as (selectedItems?: T[]) => T[] | PromiseLike<T[]>;\n    const suggestions: T[] | PromiseLike<T[]> = onEmptyInputFocus(this.state.items);\n    this.updateSuggestionsList(suggestions);\n  }\n\n  protected updateValue(updatedValue: string) {\n    this._onResolveSuggestions(updatedValue);\n  }\n\n  protected updateSuggestionsList(suggestions: T[] | PromiseLike<T[]>, updatedValue?: string) {\n    const suggestionsArray: T[] = suggestions as T[];\n    const suggestionsPromiseLike: PromiseLike<T[]> = suggestions as PromiseLike<T[]>;\n\n    // Check to see if the returned value is an array, if it is then just pass it into the next function .\n    // If the returned value is not an array then check to see if it's a promise or PromiseLike. If it is then resolve it asynchronously.\n    if (Array.isArray(suggestionsArray)) {\n      this._updateAndResolveValue(updatedValue, suggestionsArray);\n    } else if (suggestionsPromiseLike && suggestionsPromiseLike.then) {\n      this.setState({\n        suggestionsLoading: true\n      });\n\n      // Clear suggestions\n      this.suggestionStore.updateSuggestions([]);\n\n      if (updatedValue !== undefined) {\n        this.setState({\n          suggestionsVisible: this.input.current ? (this.input.current.value !== '' && this.input.current.inputElement === document.activeElement) : false\n        });\n      } else {\n        this.setState({\n          suggestionsVisible: this.input.current ? this.input.current.inputElement === document.activeElement : false\n        });\n      }\n\n      // Ensure that the promise will only use the callback if it was the most recent one.\n      const promise: PromiseLike<T[]> = this.currentPromise = suggestionsPromiseLike;\n      promise.then((newSuggestions: T[]) => {\n        if (promise === this.currentPromise) {\n          this._updateAndResolveValue(updatedValue, newSuggestions);\n        }\n      });\n    }\n  }\n\n  protected resolveNewValue(updatedValue: string, suggestions: T[]) {\n    this.updateSuggestions(suggestions);\n    let itemValue: string | undefined = undefined;\n\n    if (this.suggestionStore.currentSuggestion) {\n      itemValue = this._getTextFromItem(this.suggestionStore.currentSuggestion.item, updatedValue);\n    }\n\n    // Only set suggestionloading to false after there has been time for the new suggestions to flow\n    // to the suggestions list. This is to ensure that the suggestions are available before aria-activedescendant\n    // is set so that screen readers will read out the first selected option.\n    this.setState(\n      {\n        suggestedDisplayValue: itemValue,\n        suggestionsVisible: this.input.current\n          ? this.input.current.value !== '' && this.input.current.inputElement === document.activeElement\n          : false\n      },\n      () => this.setState({ suggestionsLoading: false })\n    );\n  }\n\n  protected onChange(items?: T[]) {\n    if (this.props.onChange) {\n      (this.props.onChange as any)(items);\n    }\n  }\n\n  protected onInputChange = (value: string): void => {\n    this.updateValue(value);\n    this.setState({\n      moreSuggestionsAvailable: true,\n      isMostRecentlyUsedVisible: false\n    });\n  }\n\n  protected onSuggestionClick = (ev: React.MouseEvent<HTMLElement>, item: any, index: number): void => {\n    this.addItemByIndex(index);\n    this.setState({ suggestionsVisible: false });\n  }\n\n  protected onSuggestionRemove = (ev: React.MouseEvent<HTMLElement>, item: IPersonaProps, index: number): void => {\n    if (this.props.onRemoveSuggestion) {\n      (this.props.onRemoveSuggestion as any)(item);\n    }\n    this.suggestionStore.removeSuggestion(index);\n  }\n\n  protected onInputFocus = (ev: React.FocusEvent<HTMLInputElement | Autofill>): void => {\n    // Only trigger all of the focus if this component isn't already focused.\n    // For example when an item is selected or removed from the selected list it should be treated\n    // as though the input is still focused.\n    if (!this.state.isFocused) {\n      this.setState({ isFocused: true });\n      this.selection.setAllSelected(false);\n      if (this.input.current && this.input.current.value === '' && this.props.onEmptyInputFocus) {\n        this.onEmptyInputFocus();\n        this.setState({\n          isMostRecentlyUsedVisible: true,\n          moreSuggestionsAvailable: false,\n          suggestionsVisible: true\n        });\n      } else if (this.input.current && this.input.current.value) {\n        this.setState({\n          isMostRecentlyUsedVisible: false,\n          suggestionsVisible: true\n        });\n      }\n      if (this.props.inputProps && this.props.inputProps.onFocus) {\n        this.props.inputProps.onFocus(ev as React.FocusEvent<HTMLInputElement>);\n      }\n    }\n  }\n\n  protected onInputBlur = (ev: React.FocusEvent<HTMLInputElement | Autofill>): void => {\n    if (this.props.inputProps && this.props.inputProps.onBlur) {\n      this.props.inputProps.onBlur(ev as React.FocusEvent<HTMLInputElement>);\n    }\n    // Only blur the entire component if an unrelated element gets focus. Otherwise treat it as though it still has focus.\n    if (!elementContains(this.root.value!, ev.relatedTarget as HTMLElement)) {\n      this.setState({ isFocused: false });\n      if (this.props.onBlur) {\n        this.props.onBlur(ev as React.FocusEvent<HTMLInputElement>);\n      }\n    }\n  }\n\n  protected onKeyDown = (ev: React.KeyboardEvent<HTMLElement>): void => {\n    const keyCode = ev.which;\n    switch (keyCode) {\n      case KeyCodes.escape:\n        if (this.state.suggestionsVisible) {\n          this.setState({ suggestionsVisible: false });\n          ev.preventDefault();\n          ev.stopPropagation();\n        }\n        break;\n\n      case KeyCodes.tab:\n      case KeyCodes.enter:\n        if (this.suggestionElement.current && this.suggestionElement.current.hasSuggestedActionSelected()) {\n          this.suggestionElement.current.executeSelectedAction();\n        } else if (!ev.shiftKey && this.suggestionStore.hasSelectedSuggestion() && this.state.suggestionsVisible) {\n          this.completeSuggestion();\n          ev.preventDefault();\n          ev.stopPropagation();\n        } else {\n          this._onValidateInput();\n        }\n\n        break;\n\n      case KeyCodes.backspace:\n        if (!this.props.disabled) {\n          this.onBackspace(ev);\n        }\n        ev.stopPropagation();\n        break;\n\n      case KeyCodes.del:\n        if (!this.props.disabled) {\n          if (this.input.current && ev.target === this.input.current.inputElement && this.state.suggestionsVisible && this.suggestionStore.currentIndex !== -1) {\n            if (this.props.onRemoveSuggestion) {\n              (this.props.onRemoveSuggestion as any)(this.suggestionStore.currentSuggestion!.item);\n            }\n            this.suggestionStore.removeSuggestion(this.suggestionStore.currentIndex);\n            this.forceUpdate();\n          } else {\n            this.onBackspace(ev);\n          }\n        }\n        ev.stopPropagation();\n        break;\n\n      case KeyCodes.up:\n        if (this.input.current && ev.target === this.input.current.inputElement && this.state.suggestionsVisible) {\n          if (this.suggestionElement.current && this.suggestionElement.current.tryHandleKeyDown(keyCode, this.suggestionStore.currentIndex)) {\n            ev.preventDefault();\n            ev.stopPropagation();\n          } else {\n            if (this.suggestionElement.current && this.suggestionElement.current.hasSuggestedAction() && this.suggestionStore.currentIndex === 0) {\n              ev.preventDefault();\n              ev.stopPropagation();\n              this.suggestionElement.current.focusAboveSuggestions();\n              this.suggestionStore.deselectAllSuggestions();\n              this.forceUpdate();\n            } else {\n              if (this.suggestionStore.previousSuggestion()) {\n                ev.preventDefault();\n                ev.stopPropagation();\n                this.onSuggestionSelect();\n              }\n            }\n          }\n        }\n        break;\n\n      case KeyCodes.down:\n        if (this.input.current && ev.target === this.input.current.inputElement && this.state.suggestionsVisible) {\n          if (this.suggestionElement.current && this.suggestionElement.current.tryHandleKeyDown(keyCode, this.suggestionStore.currentIndex)) {\n            ev.preventDefault();\n            ev.stopPropagation();\n          } else {\n            if (this.suggestionElement.current && this.suggestionElement.current.hasSuggestedAction() && (this.suggestionStore.currentIndex + 1) === this.suggestionStore.suggestions.length) {\n              ev.preventDefault();\n              ev.stopPropagation();\n              this.suggestionElement.current.focusBelowSuggestions();\n              this.suggestionStore.deselectAllSuggestions();\n              this.forceUpdate();\n            } else {\n              if (this.suggestionStore.nextSuggestion()) {\n                ev.preventDefault();\n                ev.stopPropagation();\n                this.onSuggestionSelect();\n              }\n            }\n          }\n        }\n        break;\n    }\n  }\n\n  protected onItemChange = (changedItem: T, index: number): void => {\n    const { items } = this.state;\n\n    if (index >= 0) {\n      const newItems: T[] = items;\n      newItems[index] = changedItem;\n\n      this._updateSelectedItems(newItems);\n    }\n  }\n\n  protected onGetMoreResults = (): void => {\n    this.setState({\n      isSearching: true\n    }, () => {\n      if (this.props.onGetMoreResults && this.input.current) {\n        const suggestions: T[] | PromiseLike<T[]> = (this.props.onGetMoreResults as any)(this.input.current.value, this.state.items);\n        const suggestionsArray: T[] = suggestions as T[];\n        const suggestionsPromiseLike: PromiseLike<T[]> = suggestions as PromiseLike<T[]>;\n\n        if (Array.isArray(suggestionsArray)) {\n          this.updateSuggestions(suggestionsArray);\n          this.setState({ isSearching: false });\n        } else if (suggestionsPromiseLike.then) {\n          suggestionsPromiseLike.then((newSuggestions: T[]) => {\n            this.updateSuggestions(newSuggestions);\n            this.setState({ isSearching: false });\n          });\n        }\n      } else {\n        this.setState({ isSearching: false });\n      }\n\n      if (this.input.current) {\n        this.input.current.focus();\n      }\n\n      this.setState({\n        moreSuggestionsAvailable: false,\n        isResultsFooterVisible: true\n      });\n    });\n  }\n\n  protected addItemByIndex = (index: number): void => {\n    this.addItem(this.suggestionStore.getSuggestionAtIndex(index).item);\n    if (this.input.current) {\n      this.input.current.clear();\n    }\n    this.updateValue('');\n  }\n\n  protected addItem = (item: T): void => {\n    const processedItem: T | PromiseLike<T> | null =\n      this.props.onItemSelected ? (this.props.onItemSelected as any)(item) : item;\n\n    if (processedItem === null) {\n      return;\n    }\n\n    const processedItemObject: T = processedItem as T;\n    const processedItemPromiseLike: PromiseLike<T> = processedItem as PromiseLike<T>;\n\n    if (processedItemPromiseLike && processedItemPromiseLike.then) {\n      processedItemPromiseLike.then((resolvedProcessedItem: T) => {\n        const newItems: T[] = this.state.items.concat([resolvedProcessedItem]);\n        this._updateSelectedItems(newItems);\n      });\n    } else {\n      const newItems: T[] = this.state.items.concat([processedItemObject]);\n      this._updateSelectedItems(newItems);\n    }\n    this.setState({ suggestedDisplayValue: '' });\n  }\n\n  protected removeItem = (item: IPickerItemProps<T>, focusNextItem?: boolean): void => {\n    const { items } = this.state;\n    const index: number = items.indexOf(item);\n\n    if (index >= 0) {\n      const newItems: T[] = items.slice(0, index).concat(items.slice(index + 1));\n      this._updateSelectedItems(newItems, focusNextItem ? index : undefined);\n    }\n  }\n\n  protected removeItems = (itemsToRemove: any[]): void => {\n    const { items } = this.state;\n    const newItems: T[] = items.filter((item: any) => itemsToRemove.indexOf(item) === -1);\n    const firstItemToRemove = itemsToRemove[0];\n    const index: number = items.indexOf(firstItemToRemove);\n\n    this._updateSelectedItems(newItems, index);\n  }\n\n  // This is protected because we may expect the backspace key to work differently in a different kind of picker.\n  // This lets the subclass override it and provide it's own onBackspace. For an example see the BasePickerListBelow\n  protected onBackspace(ev: React.KeyboardEvent<HTMLElement>) {\n    if (this.state.items.length && !this.input.current || this.input.current && (!this.input.current.isValueSelected && this.input.current.cursorLocation === 0)) {\n      if (this.selection.getSelectedCount() > 0) {\n        this.removeItems(this.selection.getSelection());\n      } else {\n        this.removeItem(this.state.items[this.state.items.length - 1]);\n      }\n    }\n  }\n\n  protected _isFocusZoneInnerKeystroke = (ev: React.KeyboardEvent<HTMLElement>): boolean => {\n    // If suggestions are shown const up/down keys control them, otherwise allow them through to control the focusZone.\n    if (this.state.suggestionsVisible) {\n      switch (ev.which) {\n        case KeyCodes.up:\n        case KeyCodes.down:\n          return true;\n      }\n    }\n\n    if (ev.which === KeyCodes.enter) {\n      return true;\n    }\n\n    return false;\n  }\n\n  protected getActiveDescendant() {\n    const currentIndex = this.suggestionStore.currentIndex;\n    return currentIndex > -1 && !this.state.suggestionsLoading ? 'sug-' + currentIndex : undefined;\n  }\n\n  protected getSuggestionsAlert() {\n    const currentIndex = this.suggestionStore.currentIndex;\n    if (this.props.enableSelectedSuggestionAlert) {\n      const selectedSuggestion =\n        currentIndex > -1 ? this.suggestionStore.getSuggestionAtIndex(this.suggestionStore.currentIndex) : undefined;\n      const selectedSuggestionAlertText = selectedSuggestion ? selectedSuggestion.ariaLabel : undefined;\n      return (\n        <div\n          className={ styles.screenReaderOnly }\n          role='alert'\n          id={ this._ariaMap.selectedSuggestionAlert }\n          aria-live='assertive'\n        >\n          { selectedSuggestionAlertText }{ ' ' }\n        </div>\n      );\n    }\n  }\n  /**\n   * Takes in the current updated value and either resolves it with the new suggestions\n   * or if updated value is undefined then it clears out currently suggested items\n   */\n  private _updateAndResolveValue(updatedValue: string | undefined, newSuggestions: T[]) {\n    if (updatedValue !== undefined) {\n      this.resolveNewValue(updatedValue, newSuggestions);\n    } else {\n      this.suggestionStore.updateSuggestions(newSuggestions, -1);\n      if (this.state.suggestionsLoading) {\n        this.setState({\n          suggestionsLoading: false\n        });\n      }\n    }\n  }\n\n  /**\n   * Controls what happens whenever there is an action that impacts the selected items.\n   * If selectedItems is provided as a property then this will act as a controlled component and it will not update it's own state.\n   */\n  private _updateSelectedItems(items: T[], focusIndex?: number): void {\n    if (this.props.selectedItems) {\n      // If the component is a controlled component then the controlling component will need\n      this.onChange(items);\n    } else {\n      this.setState({ items: items }, () => {\n        this._onSelectedItemsUpdated(items, focusIndex);\n      });\n    }\n  }\n\n  private _onSelectedItemsUpdated(items?: T[], focusIndex?: number): void {\n    this.resetFocus(focusIndex);\n    this.onChange(items);\n  }\n\n  private _onResolveSuggestions(updatedValue: string): void {\n    const suggestions: T[] | PromiseLike<T[]> | null = this.props.onResolveSuggestions(updatedValue, this.state.items);\n\n    if (suggestions !== null) {\n      this.updateSuggestionsList(suggestions, updatedValue);\n    }\n  }\n\n  private _onValidateInput(): void {\n    if (this.props.onValidateInput && this.input.current && (this.props.onValidateInput as any)(this.input.current.value) !== ValidationState.invalid && this.props.createGenericItem) {\n      const itemToConvert = this.props.createGenericItem(this.input.current.value, this.props.onValidateInput(this.input.current.value));\n      this.suggestionStore.createGenericSuggestion(itemToConvert);\n      this.completeSuggestion();\n    }\n  }\n\n  private _getTextFromItem(item: T, currentValue?: string): string {\n    if (this.props.getTextFromItem) {\n      return (this.props.getTextFromItem as any)(item, currentValue);\n    } else {\n      return '';\n    }\n  }\n}\n\nexport class BasePickerListBelow<T, P extends IBasePickerProps<T>> extends BasePicker<T, P> {\n  public render(): JSX.Element {\n    const { suggestedDisplayValue } = this.state;\n    const {\n      className,\n      inputProps,\n      disabled\n    } = this.props;\n\n    const selectedSuggestionAlertId: string | undefined = this.props.enableSelectedSuggestionAlert\n      ? this._ariaMap.selectedSuggestionAlert\n      : '';\n    const suggestionsAvailable: string | undefined = this.state.suggestionsVisible ? this._ariaMap.suggestionList : '';\n\n    return (\n      <div ref={ this.root }>\n        <div className={ css('ms-BasePicker', className ? className : '') } onKeyDown={ this.onKeyDown }>\n          { this.getSuggestionsAlert() }\n          <div className={ css('ms-BasePicker-text', styles.pickerText, this.state.isFocused && styles.inputFocused) }>\n            <Autofill\n              { ...inputProps as any }\n              className={ css('ms-BasePicker-input', styles.pickerInput) }\n              ref={ this.input }\n              onFocus={ this.onInputFocus }\n              onBlur={ this.onInputBlur }\n              onInputValueChange={ this.onInputChange }\n              suggestedDisplayValue={ suggestedDisplayValue }\n              aria-activedescendant={ this.getActiveDescendant() }\n              aria-expanded={ !!this.state.suggestionsVisible }\n              aria-haspopup='true'\n              autoCapitalize='off'\n              autoComplete='off'\n              role='combobox'\n              disabled={ disabled }\n              aria-controls={ `${suggestionsAvailable} ${selectedSuggestionAlertId}` || undefined }\n              aria-owns={ suggestionsAvailable || undefined }\n              onInputChange={ this.props.onInputChange }\n            />\n          </div>\n        </div>\n        { this.renderSuggestions() }\n        <SelectionZone selection={ this.selection } selectionMode={ SelectionMode.single }>\n          <FocusZone\n            componentRef={ this.focusZone }\n            className='ms-BasePicker-selectedItems'\n            isCircularNavigation={ true }\n            direction={ FocusZoneDirection.bidirectional }\n            isInnerZoneKeystroke={ this._isFocusZoneInnerKeystroke }\n            id={ this._ariaMap.selectedItems }\n          >\n            { this.renderItems() }\n          </FocusZone>\n        </SelectionZone>\n      </div>\n    );\n  }\n\n  protected onBackspace(ev: React.KeyboardEvent<HTMLElement>) {\n    // override the existing backspace method to not do anything because the list items appear below.\n  }\n}\n"]}