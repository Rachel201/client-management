{"version":3,"file":"BaseExtendedPicker.js","sourceRoot":"../src/","sources":["components/ExtendedPicker/BaseExtendedPicker.tsx"],"names":[],"mappings":";AAAA,OAAO,KAAK,KAAK,MAAM,OAAO,CAAC;AAC/B,OAAO,EACL,aAAa,EAEb,GAAG,EACH,SAAS,EACV,MAAM,iBAAiB,CAAC;AACzB,OAAO,EAAE,QAAQ,EAAE,MAAM,gBAAgB,CAAC;AAE1C,OAAO,KAAK,YAAY,MAAM,2BAA2B,CAAC;AAI1D,OAAO,EAAE,SAAS,EAAE,aAAa,EAAE,aAAa,EAAE,MAAM,iBAAiB,CAAC;AAC1E,kCAAkC;AAClC,IAAM,MAAM,GAAQ,YAAY,CAAC;AAcjC;IAAkF,8CAA0C;IAW1H,4BAAY,eAAkB;QAA9B,YACE,kBAAM,eAAe,CAAC,SAWvB;QArBM,oBAAc,GAAG,SAAS,EAAsD,CAAC;QACjF,uBAAiB,GAAG,SAAS,EAA4D,CAAC;QAEvF,UAAI,GAAG,SAAS,EAAkB,CAAC;QACnC,WAAK,GAAG,SAAS,EAAY,CAAC;QAqG9B,uBAAiB,GAAG;YAC5B,KAAI,CAAC,WAAW,EAAE,CAAC;QACrB,CAAC,CAAA;QA2BS,mBAAa,GAAG,UAAC,KAAa;YACtC,IAAI,KAAI,CAAC,cAAc,CAAC,OAAO,EAAE;gBAC/B,KAAI,CAAC,cAAc,CAAC,OAAO,CAAC,oBAAoB,CAAC,KAAK,CAAC,CAAC;aACzD;QACH,CAAC,CAAA;QAES,kBAAY,GAAG,UAAC,EAAiD;YACzE,IAAI,KAAI,CAAC,iBAAiB,CAAC,OAAO,EAAE;gBAClC,KAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC;aAC9C;YAED,IAAI,KAAI,CAAC,KAAK,CAAC,UAAU,IAAI,KAAI,CAAC,KAAK,CAAC,UAAU,CAAC,OAAO,EAAE;gBAC1D,KAAI,CAAC,KAAK,CAAC,UAAU,CAAC,OAAO,CAAC,EAAwC,CAAC,CAAC;aACzE;QACH,CAAC,CAAA;QAES,kBAAY,GAAG,UAAC,EAAiD;YACzE,IAAI,KAAI,CAAC,iBAAiB,CAAC,OAAO,EAAE;gBAClC,KAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC;aAC9C;YAED,IAAI,KAAI,CAAC,cAAc,CAAC,OAAO,EAAE;gBAC/B,KAAI,CAAC,cAAc,CAAC,OAAO,CAAC,UAAU,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;aAC9D;QACH,CAAC,CAAA;QAED,+GAA+G;QAC/G,kHAAkH;QACxG,iBAAW,GAAG,UAAC,EAAoC;YAC3D,IAAI,EAAE,CAAC,KAAK,sBAAuB,EAAE;gBACnC,OAAO;aACR;YACD,IAAI,CAAC,KAAI,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,IAAI,CAAC,KAAI,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,KAAI,CAAC,KAAK,CAAC,OAAO,IAAI,CAAC,KAAI,CAAC,KAAK,CAAC,OAAO,CAAC,eAAe,CAAC,EAAE;gBACnH,IAAI,KAAI,CAAC,iBAAiB,CAAC,OAAO,IAAK,KAAI,CAAC,KAAK,CAAC,OAAoB,CAAC,cAAc,KAAK,CAAC,EAAE;oBAC3F,KAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,YAAY,CAAC,KAAI,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;oBACnE,KAAI,CAAC,uBAAuB,EAAE,CAAC;iBAChC;aACF;QACH,CAAC,CAAA;QAES,YAAM,GAAG,UAAC,EAAqC;YACvD,IAAI,KAAI,CAAC,iBAAiB,CAAC,OAAO,EAAE;gBAClC,4CAA4C;gBAC5C,KAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;aAC3C;QACH,CAAC,CAAA;QAES,aAAO,GAAG,UAAC,EAAqD;YACxE,IAAI,KAAI,CAAC,KAAK,CAAC,OAAO,EAAE;gBACtB,IAAM,SAAS,GAAG,EAAE,CAAC,aAAa,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;gBACnD,EAAE,CAAC,cAAc,EAAE,CAAC;gBACpB,KAAI,CAAC,KAAK,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;aAC/B;QACH,CAAC,CAAA;QAES,2BAAqB,GAAG,UAAC,IAAO;YACxC,IAAI,KAAI,CAAC,iBAAiB,CAAC,OAAO,EAAE;gBAClC,KAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;aACjD;YAED,IAAI,KAAI,CAAC,KAAK,CAAC,cAAc,EAAE;gBAC7B,KAAI,CAAC,KAAK,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC;aACjC;YAED,IAAI,KAAI,CAAC,KAAK,CAAC,OAAO,EAAE;gBACtB,KAAI,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;aAC5B;YAED,IAAI,KAAI,CAAC,cAAc,CAAC,OAAO,EAAE;gBAC/B,KAAI,CAAC,cAAc,CAAC,OAAO,CAAC,UAAU,EAAE,CAAC;aAC1C;YAED,KAAI,CAAC,KAAK,EAAE,CAAC;QACf,CAAC,CAAA;QAES,6BAAuB,GAAG;YAClC,KAAI,CAAC,KAAK,EAAE,CAAC;QACf,CAAC,CAAA;QAvMC,KAAI,CAAC,SAAS,GAAG,IAAI,SAAS,CAAC,EAAE,kBAAkB,EAAE,cAAM,OAAA,KAAI,CAAC,iBAAiB,EAAE,EAAxB,CAAwB,EAAE,CAAC,CAAC;QAEvF,KAAI,CAAC,KAAK,GAAG;YACX,KAAK,EAAE,KAAI,CAAC,KAAK,CAAC,sBAAsB,CAAC,aAAa,CAAC,CAAC,CAAC,KAAI,CAAC,KAAK,CAAC,sBAAsB,CAAC,aAAa,CAAC,CAAC,CAAC,EAAE;YAC7G,qBAAqB,EAAE,EAAE;SAC1B,CAAC;QAEF,KAAI,CAAC,mBAAmB,GAAG,KAAI,CAAC,KAAK,CAAC,mBAAmB,CAAC;QAC1D,KAAI,CAAC,sBAAsB,GAAG,KAAI,CAAC,KAAK,CAAC,sBAAsB,CAAC;;IAClE,CAAC;IAGD,sBAAW,qCAAK;QADhB,kCAAkC;aAClC;YACE,OAAO,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC;QACpF,CAAC;;;OAAA;IAEM,8CAAiB,GAAxB;QACE,IAAI,CAAC,WAAW,EAAE,CAAC;IACrB,CAAC;IAEM,sDAAyB,GAAhC,UAAiC,QAAW;QAC1C,IAAI,QAAQ,CAAC,mBAAmB,EAAE;YAChC,IAAI,CAAC,mBAAmB,GAAG,QAAQ,CAAC,mBAAmB,CAAC;SACzD;QAED,IAAI,QAAQ,CAAC,sBAAsB,EAAE;YACnC,IAAI,CAAC,sBAAsB,GAAG,QAAQ,CAAC,sBAAsB,CAAC;SAC/D;IACH,CAAC;IAEM,kCAAK,GAAZ;QACE,IAAI,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE;YACtB,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;SAC5B;IACH,CAAC;IAEM,uCAAU,GAAjB;QACE,IAAI,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE;YACtB,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;SAC5B;IACH,CAAC;IAED,sBAAW,4CAAY;aAAvB;YACE,OAAO,IAAI,CAAC,KAAK,CAAC,OAAO,IAAI,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,YAAY,CAAC;QAC/D,CAAC;;;OAAA;IAEM,mCAAM,GAAb;QACU,IAAA,wDAAqB,CAAgB;QACvC,IAAA,eAIQ,EAHZ,wBAAS,EACT,0BAAU,EACV,sBAAQ,CACK;QAEf,OAAO,CACL,6BACE,GAAG,EAAG,IAAI,CAAC,IAAI,EACf,SAAS,EAAG,GAAG,CACb,eAAe,EACf,SAAS,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,CAAC,EAC7B,SAAS,EAAG,IAAI,CAAC,WAAW,EAC5B,MAAM,EAAG,IAAI,CAAC,MAAM;YAEpB,oBAAC,aAAa,IAAC,SAAS,EAAG,IAAI,CAAC,SAAS,EAAG,aAAa,EAAG,aAAa,CAAC,QAAQ;gBAChF,6BAAK,SAAS,EAAG,GAAG,CAAC,oBAAoB,EAAE,MAAM,CAAC,UAAU,CAAC,EAAG,IAAI,EAAG,MAAM;oBACzE,IAAI,CAAC,KAAK,CAAC,eAAe;oBAC1B,IAAI,CAAC,uBAAuB,EAAE;oBAC9B,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,oBAAC,QAAQ,uBAC3B,UAAyB,IAC9B,SAAS,EAAG,GAAG,CAAC,qBAAqB,EAAE,MAAM,CAAC,WAAW,CAAC,EAC1D,GAAG,EAAG,IAAI,CAAC,KAAK,EAChB,OAAO,EAAG,IAAI,CAAC,YAAY,EAC3B,OAAO,EAAG,IAAI,CAAC,YAAY,EAC3B,kBAAkB,EAAG,IAAI,CAAC,aAAa,EACvC,qBAAqB,EAAG,qBAAqB,2BACrB,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,eAC9C,iBAAiB,mBACb,MAAM,mBACN,MAAM,EACpB,cAAc,EAAC,KAAK,EACpB,YAAY,EAAC,KAAK,EAClB,IAAI,EAAC,UAAU,EACf,QAAQ,EAAG,QAAQ,mBACL,2BAA2B,EACzC,OAAO,EAAG,IAAI,CAAC,OAAO,IACtB,CAAC,CACC,CACQ;YACd,IAAI,CAAC,iBAAiB,EAAE,CACtB,CACP,CAAC;IACJ,CAAC;IAMS,wCAAW,GAArB;QACU,IAAA,wBAAK,CAAgB;QACrB,IAAA,gCAAS,CAAgB;QACjC,OAAO,SAAS,KAAK,SAAS,IAAI,KAAK,CAAC,MAAM,GAAG,SAAS,CAAC;IAC7D,CAAC;IAES,8CAAiB,GAA3B;QACE,IAAM,sBAAsB,GAAG,IAAI,CAAC,KAAK,CAAC,sBAAsB,CAAC;QACjE,OAAO,CAAC,sBAAsB,oBAC5B,YAAY,EAAE,IAAI,CAAC,cAAc,EACjC,QAAQ,EAAE,IAAI,CAAC,qBAAqB,EACpC,YAAY,EAAE,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC,CAAC,SAAS,EAC9E,aAAa,EAAE,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,IACtF,IAAI,CAAC,mBAAmB,EAC3B,CAAC,CAAC;IACN,CAAC;IAES,oDAAuB,GAAjC;QACE,IAAM,qBAAqB,GAAG,IAAI,CAAC,KAAK,CAAC,qBAAqB,CAAC;QAC/D,OAAO,CAAC,qBAAqB,oBAC3B,YAAY,EAAE,IAAI,CAAC,iBAAiB,IACjC,IAAI,CAAC,sBAAsB,EAC9B,CAAC,CAAC;IACN,CAAC;IAgFH,yBAAC;AAAD,CAAC,AAtND,CAAkF,aAAa,GAsN9F","sourcesContent":["import * as React from 'react';\nimport {\n  BaseComponent,\n  KeyCodes,\n  css,\n  createRef\n} from '../../Utilities';\nimport { Autofill } from '../../Autofill';\nimport { IInputProps } from '../../Pickers';\nimport * as stylesImport from './BaseExtendedPicker.scss';\nimport { IBaseExtendedPickerProps, IBaseExtendedPicker } from './BaseExtendedPicker.types';\nimport { IBaseFloatingPickerProps, BaseFloatingPicker } from '../../FloatingPicker';\nimport { BaseSelectedItemsList, IBaseSelectedItemsListProps } from '../../SelectedItemsList';\nimport { Selection, SelectionMode, SelectionZone } from '../../Selection';\n// tslint:disable-next-line:no-any\nconst styles: any = stylesImport;\n\nexport interface IBaseExtendedPickerState {\n  // tslint:disable-next-line:no-any\n  items?: any;\n  suggestedDisplayValue?: string;\n  moreSuggestionsAvailable?: boolean;\n  isSearching?: boolean;\n  isMostRecentlyUsedVisible?: boolean;\n  suggestionsVisible?: boolean;\n  suggestionsLoading?: boolean;\n  isResultsFooterVisible?: boolean;\n}\n\nexport class BaseExtendedPicker<T, P extends IBaseExtendedPickerProps<T>> extends BaseComponent<P, IBaseExtendedPickerState>\n  implements IBaseExtendedPicker<T> {\n  public floatingPicker = createRef<BaseFloatingPicker<T, IBaseFloatingPickerProps<T>>>();\n  public selectedItemsList = createRef<BaseSelectedItemsList<T, IBaseSelectedItemsListProps<T>>>();\n\n  protected root = createRef<HTMLDivElement>();\n  protected input = createRef<Autofill>();\n  protected selection: Selection;\n  protected floatingPickerProps: IBaseFloatingPickerProps<T>;\n  protected selectedItemsListProps: IBaseSelectedItemsListProps<T>;\n\n  constructor(basePickerProps: P) {\n    super(basePickerProps);\n\n    this.selection = new Selection({ onSelectionChanged: () => this.onSelectionChange() });\n\n    this.state = {\n      items: this.props.selectedItemsListProps.selectedItems ? this.props.selectedItemsListProps.selectedItems : [],\n      suggestedDisplayValue: '',\n    };\n\n    this.floatingPickerProps = this.props.floatingPickerProps;\n    this.selectedItemsListProps = this.props.selectedItemsListProps;\n  }\n\n  // tslint:disable-next-line:no-any\n  public get items(): any {\n    return this.selectedItemsList.current ? this.selectedItemsList.current.items : [];\n  }\n\n  public componentDidMount(): void {\n    this.forceUpdate();\n  }\n\n  public componentWillReceiveProps(newProps: P): void {\n    if (newProps.floatingPickerProps) {\n      this.floatingPickerProps = newProps.floatingPickerProps;\n    }\n\n    if (newProps.selectedItemsListProps) {\n      this.selectedItemsListProps = newProps.selectedItemsListProps;\n    }\n  }\n\n  public focus(): void {\n    if (this.input.current) {\n      this.input.current.focus();\n    }\n  }\n\n  public clearInput(): void {\n    if (this.input.current) {\n      this.input.current.clear();\n    }\n  }\n\n  public get inputElement(): HTMLInputElement | null {\n    return this.input.current && this.input.current.inputElement;\n  }\n\n  public render(): JSX.Element {\n    const { suggestedDisplayValue } = this.state;\n    const {\n      className,\n      inputProps,\n      disabled\n    } = this.props;\n\n    return (\n      <div\n        ref={ this.root }\n        className={ css(\n          'ms-BasePicker',\n          className ? className : '') }\n        onKeyDown={ this.onBackspace }\n        onCopy={ this.onCopy }\n      >\n        <SelectionZone selection={ this.selection } selectionMode={ SelectionMode.multiple }>\n          <div className={ css('ms-BasePicker-text', styles.pickerText) } role={ 'list' }>\n            { this.props.headerComponent }\n            { this.renderSelectedItemsList() }\n            { this.canAddItems() && (<Autofill\n              { ...inputProps as IInputProps }\n              className={ css('ms-BasePicker-input', styles.pickerInput) }\n              ref={ this.input }\n              onFocus={ this.onInputFocus }\n              onClick={ this.onInputClick }\n              onInputValueChange={ this.onInputChange }\n              suggestedDisplayValue={ suggestedDisplayValue }\n              aria-activedescendant={ 'sug-' + this.state.items.length }\n              aria-owns='suggestion-list'\n              aria-expanded='true'\n              aria-haspopup='true'\n              autoCapitalize='off'\n              autoComplete='off'\n              role='combobox'\n              disabled={ disabled }\n              aria-controls='selected-suggestion-alert'\n              onPaste={ this.onPaste }\n            />) }\n          </div>\n        </SelectionZone>\n        { this.renderSuggestions() }\n      </div>\n    );\n  }\n\n  protected onSelectionChange = (): void => {\n    this.forceUpdate();\n  }\n\n  protected canAddItems(): boolean {\n    const { items } = this.state;\n    const { itemLimit } = this.props;\n    return itemLimit === undefined || items.length < itemLimit;\n  }\n\n  protected renderSuggestions(): JSX.Element {\n    const onRenderFloatingPicker = this.props.onRenderFloatingPicker;\n    return (onRenderFloatingPicker({\n      componentRef: this.floatingPicker,\n      onChange: this._onSuggestionSelected,\n      inputElement: this.input.current ? this.input.current.inputElement : undefined,\n      selectedItems: this.selectedItemsList.current ? this.selectedItemsList.current.items : [],\n      ...this.floatingPickerProps\n    }));\n  }\n\n  protected renderSelectedItemsList(): JSX.Element {\n    const onRenderSelectedItems = this.props.onRenderSelectedItems;\n    return (onRenderSelectedItems({\n      componentRef: this.selectedItemsList,\n      ...this.selectedItemsListProps\n    }));\n  }\n\n  protected onInputChange = (value: string): void => {\n    if (this.floatingPicker.current) {\n      this.floatingPicker.current.onQueryStringChanged(value);\n    }\n  }\n\n  protected onInputFocus = (ev: React.FocusEvent<HTMLInputElement | Autofill>): void => {\n    if (this.selectedItemsList.current) {\n      this.selectedItemsList.current.unselectAll();\n    }\n\n    if (this.props.inputProps && this.props.inputProps.onFocus) {\n      this.props.inputProps.onFocus(ev as React.FocusEvent<HTMLInputElement>);\n    }\n  }\n\n  protected onInputClick = (ev: React.MouseEvent<HTMLInputElement | Autofill>): void => {\n    if (this.selectedItemsList.current) {\n      this.selectedItemsList.current.unselectAll();\n    }\n\n    if (this.floatingPicker.current) {\n      this.floatingPicker.current.showPicker(true /*updateValue*/);\n    }\n  }\n\n  // This is protected because we may expect the backspace key to work differently in a different kind of picker.\n  // This lets the subclass override it and provide it's own onBackspace. For an example see the BasePickerListBelow\n  protected onBackspace = (ev: React.KeyboardEvent<HTMLElement>): void => {\n    if (ev.which !== KeyCodes.backspace) {\n      return;\n    }\n    if ((this.state.items.length && !this.input.current) || (this.input.current && !this.input.current.isValueSelected)) {\n      if (this.selectedItemsList.current && (this.input.current as Autofill).cursorLocation === 0) {\n        this.selectedItemsList.current.removeItemAt(this.items.length - 1);\n        this._onSelectedItemsChanged();\n      }\n    }\n  }\n\n  protected onCopy = (ev: React.ClipboardEvent<HTMLElement>): void => {\n    if (this.selectedItemsList.current) {\n      // Pass it down into the selected items list\n      this.selectedItemsList.current.onCopy(ev);\n    }\n  }\n\n  protected onPaste = (ev: React.ClipboardEvent<Autofill | HTMLInputElement>): void => {\n    if (this.props.onPaste) {\n      const inputText = ev.clipboardData.getData('Text');\n      ev.preventDefault();\n      this.props.onPaste(inputText);\n    }\n  }\n\n  protected _onSuggestionSelected = (item: T): void => {\n    if (this.selectedItemsList.current) {\n      this.selectedItemsList.current.addItems([item]);\n    }\n\n    if (this.props.onItemSelected) {\n      this.props.onItemSelected(item);\n    }\n\n    if (this.input.current) {\n      this.input.current.clear();\n    }\n\n    if (this.floatingPicker.current) {\n      this.floatingPicker.current.hidePicker();\n    }\n\n    this.focus();\n  }\n\n  protected _onSelectedItemsChanged = (): void => {\n    this.focus();\n  }\n}"]}